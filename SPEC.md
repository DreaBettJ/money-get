# money-get SPEC

> A股投资辅助 Agent - 技术规格说明书

## 1. 项目概述

### 1.1 目标
帮助个人投资者进行历史操作复盘和市场数据分析，通过 AI Agent 自动化处理。

### 1.2 核心价值
- **复盘**：从操作历史中学习，提高胜率
- **分析**：用 LLM 分析 K 线、板块、资金流向
- **监控**：舆情、政策监控（可选）

---

## 2. 功能模块

### 2.1 历史操作复盘（核心功能）

| 功能 | 说明 |
|-----|------|
| 记录买卖 | 手动输入：股票代码、买入价、卖出价、数量、日期 |
| 胜率统计 | 统计盈利/亏损次数、胜率 |
| 盈亏比 | 平均盈利 vs 平均亏损 |
| 模式识别 | 找出常买的股票类型、常止损的时机 |
| 归因分析 | 这次赚钱/亏钱的原因是什么？ |

**数据结构：**
```python
class Trade:
    stock_code: str        # 600519
    stock_name: str        # 贵州茅台
    direction: str         # "buy" / "sell"
    price: float          # 买入/卖出价格
    quantity: int         # 数量
    date: str             # 2024-01-15
    reason: str           # 买入理由（可选）
    notes: str            # 备注（可选）
```

### 2.2 历史数据分析

| 功能 | 说明 |
|-----|------|
| K线分析 | 压力位、支撑位、趋势判断 |
| 成交量分析 | 放量/缩量、主力资金动向 |
| 板块轮动 | 当前热点板块、轮动规律 |
| 资金流向 | 北向资金、主力净流入 |

**数据来源：**
- 免费：akshare（Python 库）
- 付费：东方财富 API / 同花顺

### 2.3 上下文隔离（记忆管理）

| 策略 | 说明 |
|-----|------|
| 按股票隔离 | 每个股票一个记忆文件 |
| 按时间隔离 | 每周/月总结，不存原始数据 |
| 向量检索 | 用 embedding 相似度召回 |
| 摘要压缩 | 定期压缩历史对话 |

**实现方案：**
```
Memory/
├── stocks/
│   ├── 600519.md      # 茅台专属记忆
│   ├── 000858.md      # 五粮液专属记忆
│   └── ...
├── summary/
│   ├── 2024-01.md     # 月度总结
│   └── 2024-W01.md    # 周度总结
└── vector.db          # 向量索引
```

---

## 3. 技术架构

### 3.1 系统架构

```
┌─────────────────────────────────────────────────────┐
│                    money-get                        │
├─────────────────────────────────────────────────────┤
│                                                     │
│  ┌──────────┐    ┌──────────┐    ┌──────────┐    │
│  │ 用户输入  │    │ Webhook  │    │  Cron    │    │
│  │          │    │ (行情)   │    │ (定时)   │    │
│  └────┬─────┘    └────┬─────┘    └────┬─────┘    │
│       │               │               │           │
│       └───────────────┼───────────────┘           │
│                       ▼                            │
│  ┌──────────────────────────────────────────┐     │
│  │              Agent 核心                   │     │
│  │  ┌────────┐ ┌────────┐ ┌────────┐       │     │
│  │  │ Planner│ │ Analyst│ │ Memory │       │     │
│  │  │        │ │        │ │        │       │     │
│  │  └────────┘ └────────┘ └────────┘       │     │
│  └──────────────────┬───────────────────────┘     │
│                     ▼                              │
│  ┌──────────────────────────────────────────┐     │
│  │              输出层                        │     │
│  │  ┌────────┐ ┌────────┐ ┌────────┐       │     │
│  │  │  文字  │ │  钉钉  │ │  QQ   │       │     │
│  │  │  报告  │ │  推送  │ │  推送  │       │     │
│  │  └────────┘ └────────┘ └────────┘       │     │
│  └──────────────────────────────────────────┘     │
└─────────────────────────────────────────────────────┘
```

### 3.2 技术栈

| 层级 | 技术选型 |
|-----|---------|
| 语言 | Python 3.10+ |
| Agent 框架 | LangChain / LangGraph |
| LLM | MiniMax API |
| 数据获取 | akshare（免费） |
| 向量存储 | FAISS / Chroma |
| 推送 | 钉钉 Webhook / Server 酱 |
| 部署 | Docker / 本地运行 |

### 3.3 目录结构

```
money-get/
├── src/
│   ├── __init__.py
│   ├── agent/           # Agent 核心
│   │   ├── __init__.py
│   │   ├── planner.py   # 任务规划
│   │   ├── analyst.py   # 分析模块
│   │   └── memory.py    # 记忆管理
│   ├── data/            # 数据层
│   │   ├── __init__.py
│   │   ├── stock.py     # 股票数据
│   │   ├── trade.py     # 交易记录
│   │   └── news.py      # 舆情数据
│   ├── tools/           # 工具
│   │   ├── __init__.py
│   │   ├── analysis.py  # 分析工具
│   │   └── push.py      # 推送工具
│   └── config.py        # 配置
├── data/                # 数据文件
│   ├── trades.json      # 交易记录
│   ├── memory/          # Agent 记忆
│   └── cache/           # 缓存
├── tests/               # 测试
├── pyproject.toml
├── README.md
└── SPEC.md
```

---

## 4. 接口定义

### 4.1 交易记录 API

```python
# 记录一笔交易
POST /api/trades
{
    "stock_code": "600519",
    "stock_name": "贵州茅台",
    "direction": "buy",
    "price": 1850.0,
    "quantity": 100,
    "date": "2024-01-15",
    "reason": "估值合理，业绩稳定"
}

# 获取所有交易
GET /api/trades

# 获取统计报告
GET /api/trades/stats
```

### 4.2 分析 API

```python
# 复盘分析
POST /api/analyze/review
{
    "stock_code": "600519",  # 可选，不传则分析所有
    "period": "2024-01"       # 可选，月份
}

# 市场分析
POST /api/analyze/market
{
    "stock_codes": ["600519", "000858"]
}
```

### 4.3 推送配置

```python
# 钉钉配置
DINGTALK_WEBHOOK = "https://oapi.dingtalk.com/robot/send?access_token=xxx"

# 飞书配置
FEISHU_WEBHOOK = "https://open.feishu.cn/open-apis/bot/v2/hook/xxx"
```

---

## 5. 实施计划

### Phase 1：核心功能（1周）
- [ ] 交易记录 CRUD
- [ ] 基础统计（胜率、盈亏比）
- [ ] LLM 复盘分析

### Phase 2：数据分析（1周）
- [ ] 接入 akshare
- [ ] K线分析工具
- [ ] 市场热点分析

### Phase 3：记忆管理（1周）
- [ ] 按股票隔离记忆
- [ ] 向量检索
- [ ] 定期压缩

### Phase 4：推送集成（1周）
- [ ] 钉钉 Webhook
- [ ] 定时任务
- [ ] OpenClaw 集成

---

## 6. 待确认

- [ ] 数据源选择（akshare 免费还是付费 API）
- [ ] 推送方式（钉钉/飞书/QQ）
- [ ] 部署方式（本地/Docker/服务器）
- [ ] 初始股票池（关注哪几只）

---

## 7. 风险与限制

1. **数据延迟**：akshare 有 15 分钟延迟
2. **API 限流**：免费接口有频率限制
3. **LLC 幻觉**：分析结论需人工复核
4. **存储上限**：历史数据需要定期归档
